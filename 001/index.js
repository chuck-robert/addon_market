/*QUIK_ADDON 1|天气|1|1.0.0|在QUIK起始页左上角显示今日天气|siquan|https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/01.png|https://siquan001.github.io/|version.txt|siquan.weather */
var cachesto=quik.storage("q-weather-cache"),waitLics=function(){var n=new quik.dialog({content:'<div class="lic-c"><h1>天气 插件使用须知</h1>\n<h2>用户协议</h2>\n<p>1. 天气数据来源于“腾讯天气”，其中若有内容问题，请联系“腾讯天气”相关负责人，本插件与QUIK起始页不负责任。</p>\n<p>1. 位置数据来源于“腾讯地图API”，其中若有内容问题，请联系“腾讯地图API”相关负责人，本插件与QUIK起始页不负责任。</p>\n<h2>隐私政策</h2>\n<p>1. 我们需要收集您的IP地址以获取您的大致位置信息，我们只是确定您所在的市、县、区，您的精确位置不会被定位</p></div><div class="btns"><div class="btn cancel">不同意</div><div class="btn ok">同意</div></div>'}),e=n.getDialogDom();util.query(e,".btn.cancel").onclick=function(){t(!1),n.close()},util.query(e,".btn.ok").onclick=function(){cachesto.set("lic",!0),t(!0),n.close()};var t=function(){};return function(e){cachesto.get("lic")?e(!0):(t=e,n.open())}}();waitLics((function(n){n?function(){var n={location:null,weather:null},e=quik.util,t=!1,i=[];function a(e,t={}){!n.location||t.refresh?i.push(quik.util.jsonp("https://apis.map.qq.com/ws/location/v1/ip?key=DX2BZ-AGNK7-T62XY-H4KZZ-KOUWF-KAB3T&output=jsonp",(function(t){n.location=t.result.ad_info,cachesto.set("location",t.result.ad_info),e(t.result.ad_info)}))):e(n.location)}function c(e,t={}){quik.util.checkDetailsCorrect(t,["province","city","county"])?n.weather&&function(n,e){if(Object.keys(n).length>e){for(var t in n)if(n[t]!=e[t])return!1}else for(var t in e)if(n[t]!=e[t])return!1;return!0}(n.weather.offset,{province:t.province,city:t.city,county:t.county})&&!t.refresh?e(n.weather.data):i.push(quik.util.jsonp("https://wis.qq.com/weather/common?source=pc&weather_type=observe%7Cforecast_1h%7Cforecast_24h%7Cair%7Crise%7Calarm&province="+(t.province||"")+"&city="+(t.city||"")+"&county="+(t.county||"")+"&_="+Date.now(),(function(a){a&&200==a.status?i.push(quik.util.jsonp("https://wis.qq.com/weather/common?source=pc&weather_type=air%7Crise&province="+t.province+"&city="+t.city+"&_="+Date.now(),(function(i){a&&200==a.status&&(a.data.air=i.data.air),n.weather={offset:{province:t.province,city:t.city,county:t.county},data:a.data},e(a.data)}))):e({err:!0,code:-2,msg:"请求错误:"+a.status+" "+a.message})}))):e({err:!0,code:-1,msg:"内容不齐"})}cachesto.get("location")&&(n.location=cachesto.get("location"));var r=new quik.iconc.icon({content:'<div><span class="location-text">...</span>\n        <img class="weather-img" src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/02.png"/>\n        <span class="weather-text">...</span>\n        <span class="degree-text">...</span></div>',width:150,offset:"tl",class:"weather-icon",important:!0});function o(){var n=r.getIcon();e.query(n,".location-text").innerText=e.query(p,".con.a .location span:nth-child(2)").innerText="--",e.query(p,".con.a .weather-name").innerText=e.query(n,".weather-text").innerText="--",e.query(p,".con.a .weather-temp").innerText=e.query(n,".degree-text").innerText="-℃",e.query(p,".con.a img").src=e.query(n,".weather-img").src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/01.png",e.query(p,".con.a .weather-wind span:nth-child(2)").innerText="-风---级",e.query(p,".con.a .weather-wet span:nth-child(2)").innerText="--%",e.query(p,".con.a .weather-pa span:nth-child(2)").innerText="--hPa",e.query(p,".con.b .sc ul").innerHTML="",e.query(p,".con.c .sc ul").innerHTML="",e.query(p,".con.d .aqi .result").innerHTML="-",e.query(p,".con.d .aqi .pinjia").innerHTML="-",e.query(p,".con.d .aqi .pinjia").style.background="",e.query(p,".con.d .co .result").innerHTML="-",e.query(p,".con.d .no2 .result").innerHTML="-",e.query(p,".con.d .o3 .result").innerHTML="-",e.query(p,".con.d .pm25 .result").innerHTML="-",e.query(p,".con.d .pm10 .result").innerHTML="-",e.query(p,".con.d .so2 .result").innerHTML="-",e.query(p,".con.a .weather-alarm").innerText="",e.query(p,".con.a .weather-alarm").style.background="",e.query(p,".con.a .weather-alarm").onclick=function(){}}function s(n){i.forEach((function(n){n.abort()})),c((function(i){var a=r.getIcon();e.query(a,".location-text").innerText=e.query(p,".con.a .location span:nth-child(2)").innerText=n.district||n.city||n.province,e.query(p,".con.a .weather-name").innerText=e.query(a,".weather-text").innerText=i.observe.weather,e.query(p,".con.a .weather-temp").innerText=e.query(a,".degree-text").innerText=i.observe.degree+"℃",e.query(p,".con.a img").src=e.query(a,".weather-img").src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/"+l(i.rise[0])+"/"+i.observe.weather_code+".png",e.query(p,".con.a .weather-wind span:nth-child(2)").innerText=i.observe.wind_direction_name+i.observe.wind_power+"级",e.query(p,".con.a .weather-wet span:nth-child(2)").innerText=i.observe.humidity+"%",e.query(p,".con.a .weather-pa span:nth-child(2)").innerText=i.observe.pressure+"hPa";var c=e.query(p,".con.b .sc ul"),o=i.forecast_24h,s="",d=0;for(var u in o)d++,s+='<li><p class="time">'+o[u].time.split("-")[1]+"-"+o[u].time.split("-")[2]+'</p><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/'+o[u].day_weather_code+'.png"><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/night/'+o[u].night_weather_code+'.png"><p class="temp">'+o[u].min_degree+"℃~"+o[u].max_degree+'℃</p><p class="wind">'+o[u].day_wind_direction+o[u].day_wind_power+"级-"+o[u].night_wind_direction+o[u].night_wind_power+"级</p></li>";c.innerHTML=s,c.style.width=100*d+"px";var h=e.query(p,".con.c .sc ul"),w=i.forecast_1h,f="",v=0;for(var u in w)v++,f+='<li><p class="time">'+w[u].update_time.substring(8,10)+':00</p><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/'+l(i.rise[0],parseInt(w[u].update_time.substring(8,10)))+"/"+w[u].weather_code+'.png"/><p class="temp">'+w[u].degree+'℃</p><p class="wind">'+w[u].wind_direction+w[u].wind_power+"级</p></li>";h.innerHTML=f,h.style.width=100*v+"px";var y=i.air;if(e.query(p,".con.d .aqi .result").innerHTML=y.aqi,e.query(p,".con.d .aqi .pinjia").innerHTML=y.aqi_name,e.query(p,".con.d .aqi .pinjia").style.background=["","#a3d765","#f0cc35","#f1ab62","#ef7f77","#b28ccb","#ad788a"][y.aqi_level],e.query(p,".con.d .co .result").innerHTML=y.co,e.query(p,".con.d .no2 .result").innerHTML=y.no2,e.query(p,".con.d .o3 .result").innerHTML=y.o3,e.query(p,".con.d .pm25 .result").innerHTML=y["pm2.5"],e.query(p,".con.d .pm10 .result").innerHTML=y.pm10,e.query(p,".con.d .so2 .result").innerHTML=y.so2,i.alarm[0]){e.query(p,".con.a .weather-alarm").innerText=i.alarm[0].type_name+i.alarm[0].level_name+"预警";e.query(p,".con.a .weather-alarm").style.background={"01":"#86c5f7","02":"#f5d271","03":"#ef8c6b","04":"#ec807c"}[i.alarm[0].level_code],e.query(p,".con.a .weather-alarm").onclick=function(){quik.alert(i.alarm[0].detail,(function(){setTimeout((function(){t=!1}),10)})),t=!0}}}),{province:n.province,city:n.city,county:n.district,refresh:!0})}function l(n,e){var t=n.sunrise.split(":");t=60*parseInt(t[0])+parseInt(t[1]);var i,a=n.sunset.split(":");return a=60*parseInt(a[0])+parseInt(a[1]),t<(i=void 0===e?60*(i=new Date).getHours()+i.getMinutes():60*e)&&i<a?"day":"night"}r.show(),r.getIcon().onclick=function(n){n.stopPropagation(),d.show(300),d.setOffset({top:34,left:15},300)},document.addEventListener("click",(function(){t||(d.hide(300),d.setOffset({top:34,left:-315},300))})),a((function(n){s(n)}));var d=new quik.card({content:'<div class="tabi">\n    <div class="item" data-i="a">今日</div>\n    <div class="item" data-i="b">七日天气</div>\n    <div class="item" data-i="c">24小时</div>\n    <div class="item" data-i="d">空气质量</div>\n</div>\n\n<div class="tabcon">\n    <div class="con a" data-i="a">\n        <div class="left">\n            <div class="location"><span title="定位" class="relocate">icon{e0c8}</span><span class="replacecity" title="切换城市">---</span></div>\n            <div class="weatherss">\n                <img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/01.png">\n                <p class="weather-temp">--℃</p>\n                <p class="weather-name">--</p>\n            </div>\n        </div>\n        <div class="right">\n            <p class="weather-wind">icon{e569}<span>-风---级</span></p>\n            <p class="weather-wet">icon{e798}湿度 <span>--%</span></p>\n            <p class="weather-pa">icon{e87a}气压 <span>---hPa</span></p>\n            <p class="weather-alarm"></p>\n        </div>\n    </div>\n    <div class="con b" data-i="b">\n        <div class="sc">\n            <ul></ul>\n        </div>\n    </div>\n    <div class="con c" data-i="c">\n        <div class="sc">\n            <ul></ul>\n        </div>\n    </div>\n    <div class="con d" data-i="d">\n        <div class="aqi">\n            <p class="title">AQI</p>\n            <p class="result">-</p>\n            <p class="pinjia">-</p>\n        </div>\n        <div class="wurans">\n            <div class="co">\n                <p class="title">CO</p>\n                <p class="result">-</p>\n            </div>\n            <div class="no2">\n                <p class="title">NO<sub>2</sub></p>\n                <p class="result">-</p>\n            </div>\n            <div class="o3">\n                <p class="title">O<sub>3</sub></p>\n                <p class="result">-</p>\n            </div>\n            <div class="pm25">\n                <p class="title">PM2.5</p>\n                <p class="result">-</p>\n            </div>\n            <div class="pm10">\n                <p class="title">PM10</p>\n                <p class="result">-</p>\n            </div>\n            <div class="so2">\n                <p class="title">SO<sub>2</sub></p>\n                <p class="result">-</p>\n            </div>\n        </div>\n    </div>\n</div>'.replace(/icon{[a-zA-Z0-9]*}/g,(function(n){return e.getGoogleIcon(n.replace("icon{","").replace("}",""))})),class:"weather-card",width:300,height:200,offset:{top:34,left:-315}}),p=d.getCardDom();p.addEventListener("click",(function(n){n.stopPropagation()}));var u=e.query(p,".tabi .item",!0),h=e.query(p,".tabcon .con",!0);u.forEach((function(n){n.onclick=function(){u.forEach((function(n){n.classList.remove("active")})),h.forEach((function(n){n.classList.remove("active")})),this.classList.add("active"),e.query(p,'.tabcon .con[data-i="'+this.dataset.i+'"]').classList.add("active")}})),e.query(p,".relocate").addEventListener("click",(function(){o(),i.forEach((function(n){n.abort()})),a((function(n){s(n)}),{refresh:!0})}));var w,f,v,y=(w=new quik.dialog({content:'<div class="bar">\n    <div class="closeBtn">{e5cd}</div>\n    <div class="searchcitybox">\n        <input type="search" class="searchcityinput" placeholder="搜索市、区、县等">\n    </div>\n</div>\n<div class="results">\n    \n</div>'.replace("{e5cd}",e.getGoogleIcon("e5cd")),class:"cityselector",clickOtherToClose:!1}),f=function(){},v=w.getDialogDom(),e.query(v,".closeBtn").addEventListener("click",(function(){f(!1),w.close()})),e.query(v,".searchcityinput").addEventListener("input",(function(){if(""!=this.value.trim())var n=this.value.trim();e.jsonp("https://wis.qq.com/city/like?source=pc&city="+encodeURI(n),(function(i){if(i&&200==i.status){var a="";for(var c in i.data)a+='<div class="item" data-t="'+i.data[c]+'">'+i.data[c].replace(n,'<span style="color:#09f">'+n+"</span>")+"</div>";e.query(v,".results").innerHTML=a,e.query(v,".results .item",!0).forEach((function(n){n.onclick=function(){var n=this.dataset.t.split(", ");f({province:n[0],city:n[1],county:n[2]}),e.query(v,".results").innerHTML="",w.close(),setTimeout((function(){t=!1}),10)}}))}}))})),function(n){t=!0,w.open(),f=n});e.query(p,".replacecity").addEventListener("click",(function(){y((function(e){e&&(cachesto.set("location",{province:e.province,city:e.city,district:e.county}),n.location={province:e.province,city:e.city,district:e.county},o(),s({province:e.province,city:e.city,district:e.county}))}))})),u[0].click(),quik.util.addStyle(".weather-icon>div{\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.weather-icon>div>*{\n    height: 30px;\n    line-height: 30px;\n    margin: 0 2px;\n    font-size: 14px;\n}\n.weather-icon img{\n    height: 24px;\n    margin: 3px 2px;\n}\n.weather-card{\n    user-select: none;\n}\n.weather-card .tabi{\n    width: 100%;\n    height: 30px;\n}\n.weather-card .tabi .item{\n    float: left;\n    margin: 3px 5px;\n    line-height: 20px;\n    height: 20px;\n    font-size: 12px;\n    padding: 1px 5px;\n    border-radius: 3px;\n    user-select: none;\n}\n.weather-card .tabi .item.active{\n    background-color: #eee;\n}\n.weather-card .tabi .item:hover{\n    background-color: #f6f6f6;\n}\n.weather-card .tabcon{\n    width: 100%;\n    height: calc(100% - 30px);\n}\n.weather-card .tabcon .con{\n    width: 100%;\n    height: 100%;\n    display: none;\n}\n.weather-card .tabcon .con.active{\n    display: block;\n}\n.weather-card .tabcon .con.a .left,\n.weather-card .tabcon .con.a .right\n{\n    width:50%;\n    height: 100%;\n    float: left;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n}\n.weather-card .tabcon .con.a{\n    text-align: center;\n    line-height: 20px;\n}\n.weather-card .tabcon .con.a .right p{\n    padding: 5px 0;\n}\n.weather-card .tabcon .con.a .right .weather-alarm{\n    cursor: pointer;\n    padding:0 1em;\n    border-radius: 1em;\n    color: #fff;\n    font-size: 14px;\n}\n.weather-card .tabcon .con.a .material-symbols-outlined{\n    font-size: inherit;\n    padding-right: 5px;\n    line-height: inherit;\n    float: left;\n}\n.weather-card .tabcon .sc{\n    width: 100%;\n    height: 100%;\n    overflow-y: hidden;\n    overflow-x: auto;\n}\n.weather-card .tabcon .sc ul{\n    height: 100%;\n}\n.weather-card .tabcon .sc ul li{\n    width: 80px;\n    height: 100%;\n    margin: 0 10px;\n    float: left;\n    list-style: none;\n    font-size: 12px;\n    text-align: center;\n}\n.weather-card .tabcon .sc ul li img {\n    width: 35px;\n    display: block;\n    height: 35px;\n    margin: 0 auto;\n}\n.weather-card .tabcon .con.c .sc ul li{\n    font-size: 16px;\n}\n.weather-card .tabcon .con.c .sc ul li img {\n    width: 50px;\n    height: 50px;\n}\n.weather-card .tabcon .con.c .sc ul li p.time{\n    padding-top: 10px;\n}\n.weather-card .tabcon .con.c .sc ul li p.wind{\n    font-size: 12px;\n}\n\n.weather-card .tabcon .con.d .aqi {\n    width: 80px;\n    height: calc(100% - 40px);\n    padding: 20px 0;\n    float: left;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.weather-card .tabcon .con.d .aqi .result{\n    font-size: 20px;\n}\n\n.weather-card .tabcon .con.d .wurans {\n    float: left;\n    width: calc(100% - 80px);\n    height: 100%;\n}\n.weather-card .tabcon .con.d .wurans>* {\n    float: left;\n    width: calc(33% - 10px);\n    height: calc(50% - 10px);\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    background-color: #fafafa;\n    border-radius: 10px;\n    margin: 5px;\n}\n.weather-card .tabcon .con.d .aqi p.pinjia {\n    width: 1em;\n    height: 1em;\n    line-height: 1em;\n    border-radius: 3px;\n    font-size: 12px;\n    padding: 4px;\n}\n.cityselector .bar>*{\n    float: left;\n    height: 30px;\n    font-size: 16px;\n    user-select: none;\n}\n.cityselector .bar input{\n    height: 30px;\n}")}():quik.alert("如您不同意，请卸载本插件。")}));