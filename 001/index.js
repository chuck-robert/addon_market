/*QUIK_ADDON 1|天气|3|1.0.2|在QUIK起始页左上角显示今日天气|siquan|https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/01.png|https://siquan001.github.io/|version.txt|siquan.weather */
var e=quik.storage("q-weather-cache");(function(){var t=new quik.dialog({content:'<div class="lic-c"><h1>天气 插件使用须知</h1><h2>用户协议</h2><p>1. 天气数据来源于“腾讯天气”，其中若有内容问题，请联系“腾讯天气”相关负责人，本插件与QUIK起始页不负责任。</p><p>1. 位置数据来源于“腾讯地图API”，其中若有内容问题，请联系“腾讯地图API”相关负责人，本插件与QUIK起始页不负责任。</p><h2>隐私政策</h2><p>1. 我们需要收集您的IP地址以获取您的大致位置信息，我们只是确定您所在的市、县、区，您的精确位置不会被定位</p></div><div class="btns"><div class="btn cancel">不同意</div><div class="btn ok">同意</div></div>'}),i=t.getDialogDom();util.query(i,".btn.cancel").onclick=function(){a(!1),t.close()},util.query(i,".btn.ok").onclick=function(){e.set("lic",!0),a(!0),t.close()};var a=function(){};return function(i){e.get("lic")?i(!0):(a=i,t.open())}})()((function(t){t?function(){var t={location:null,weather:null},i=quik.util,a=!1,n=[];e.get("location")&&(t.location=e.get("location"),console.log("ca"));var c={province:"北京",city:"北京",district:void 0};function r(i,a={}){!t.location||a.refresh?n.push(quik.util.jsonp("https://apis.map.qq.com/ws/location/v1/ip?key=DX2BZ-AGNK7-T62XY-H4KZZ-KOUWF-KAB3T&output=jsonp",(function(a){a&&0==a.status?(t.location=a.result.ad_info,e.set("location",a.result.ad_info),i(a.result.ad_info)):i(c)}))):i(t.location)}function o(e,i={}){quik.util.checkDetailsCorrect(i,["province","city","county"])?t.weather&&function(e,t){if(Object.keys(e).length>t){for(var i in e)if(e[i]!=t[i])return!1}else for(var i in t)if(e[i]!=t[i])return!1;return!0}(t.weather.offset,{province:i.province,city:i.city,county:i.county})&&!i.refresh?e(t.weather.data):n.push(quik.util.jsonp("https://wis.qq.com/weather/common?source=pc&weather_type=observe%7Cforecast_1h%7Cforecast_24h%7Cair%7Crise%7Calarm&province="+(i.province||"")+"&city="+(i.city||"")+"&county="+(i.county||"")+"&_="+Date.now(),(function(a){a&&200==a.status?n.push(quik.util.jsonp("https://wis.qq.com/weather/common?source=pc&weather_type=air%7Crise&province="+i.province+"&city="+i.city+"&_="+Date.now(),(function(n){a&&200==a.status&&(a.data.air=n.data.air),t.weather={offset:{province:i.province,city:i.city,county:i.county},data:a.data},e(a.data)}))):e({err:!0,code:-2,msg:a?a.status+" "+a.message:"网络错误"})}))):e({err:!0,code:-1,msg:"内容不齐"})}var s=new quik.iconc.icon({content:'<div><span class="location-text">...</span>\n        <img class="weather-img" src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/02.png"/>\n        <span class="weather-text">...</span>\n        <span class="degree-text">...</span></div>',width:150,offset:"tl",class:"weather-icon",important:!0});function l(){var e=s.getIcon();i.query(e,".location-text").innerText=i.query(h,".con.a .location span:nth-child(2)").innerText="--",i.query(h,".con.a .weather-name").innerText=i.query(e,".weather-text").innerText="--",i.query(h,".con.a .weather-temp").innerText=i.query(e,".degree-text").innerText="-℃",i.query(h,".con.a img").src=i.query(e,".weather-img").src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/01.png",i.query(h,".con.a .weather-wind span:nth-child(2)").innerText="-风---级",i.query(h,".con.a .weather-wet span:nth-child(2)").innerText="--%",i.query(h,".con.a .weather-pa span:nth-child(2)").innerText="--hPa",i.query(h,".con.b .sc ul").innerHTML="",i.query(h,".con.c .sc ul").innerHTML="",i.query(h,".con.d .aqi .result").innerHTML="-",i.query(h,".con.d .aqi .pinjia").innerHTML="-",i.query(h,".con.d .aqi .pinjia").style.background="",i.query(h,".con.d .co .result").innerHTML="-",i.query(h,".con.d .no2 .result").innerHTML="-",i.query(h,".con.d .o3 .result").innerHTML="-",i.query(h,".con.d .pm25 .result").innerHTML="-",i.query(h,".con.d .pm10 .result").innerHTML="-",i.query(h,".con.d .so2 .result").innerHTML="-",i.query(h,".con.a .weather-alarm").innerText="",i.query(h,".con.a .weather-alarm").style.background="",i.query(h,".con.a .weather-alarm").onclick=function(){}}function d(e){n.forEach((function(e){e.abort()})),o((function(t){if(console.log(t),t.err)quik.toast.show("天气请求错误（ERR:"+t.msg+"）");else{var n=s.getIcon();i.query(n,".location-text").innerText=i.query(h,".con.a .location span:nth-child(2)").innerText=e.district||e.city||e.province,i.query(h,".con.a .weather-name").innerText=i.query(n,".weather-text").innerText=t.observe.weather,i.query(h,".con.a .weather-temp").innerText=i.query(n,".degree-text").innerText=t.observe.degree+"℃",i.query(h,".con.a img").src=i.query(n,".weather-img").src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/"+p(t.rise[0])+"/"+t.observe.weather_code+".png",i.query(h,".con.a .weather-wind span:nth-child(2)").innerText=t.observe.wind_direction_name+t.observe.wind_power+"级",i.query(h,".con.a .weather-wet span:nth-child(2)").innerText=t.observe.humidity+"%",i.query(h,".con.a .weather-pa span:nth-child(2)").innerText=t.observe.pressure+"hPa";var c=i.query(h,".con.b .sc ul"),r=t.forecast_24h,o="",l=0;for(var d in r)l++,o+='<li><p class="time">'+r[d].time.split("-")[1]+"-"+r[d].time.split("-")[2]+'</p><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/'+r[d].day_weather_code+'.png"><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/night/'+r[d].night_weather_code+'.png"><p class="temp">'+r[d].min_degree+"℃~"+r[d].max_degree+'℃</p><p class="wind">'+r[d].day_wind_direction+r[d].day_wind_power+"级-"+r[d].night_wind_direction+r[d].night_wind_power+"级</p></li>";c.innerHTML=o,c.style.width=100*l+"px";var u=i.query(h,".con.c .sc ul"),w=t.forecast_1h,v="",y=0;for(var d in w)y++,v+='<li><p class="time">'+w[d].update_time.substring(8,10)+':00</p><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/'+p(t.rise[0],parseInt(w[d].update_time.substring(8,10)))+"/"+w[d].weather_code+'.png"/><p class="temp">'+w[d].degree+'℃</p><p class="wind">'+w[d].wind_direction+w[d].wind_power+"级</p></li>";u.innerHTML=v,u.style.width=100*y+"px";var f=t.air;if(i.query(h,".con.d .aqi .result").innerHTML=f.aqi,i.query(h,".con.d .aqi .pinjia").innerHTML=f.aqi_name,i.query(h,".con.d .aqi .pinjia").style.background=["","#a3d765","#f0cc35","#f1ab62","#ef7f77","#b28ccb","#ad788a"][f.aqi_level],i.query(h,".con.d .co .result").innerHTML=f.co,i.query(h,".con.d .no2 .result").innerHTML=f.no2,i.query(h,".con.d .o3 .result").innerHTML=f.o3,i.query(h,".con.d .pm25 .result").innerHTML=f["pm2.5"],i.query(h,".con.d .pm10 .result").innerHTML=f.pm10,i.query(h,".con.d .so2 .result").innerHTML=f.so2,t.alarm[0]){i.query(h,".con.a .weather-alarm").innerText=t.alarm[0].type_name+t.alarm[0].level_name+"预警";i.query(h,".con.a .weather-alarm").style.background={"01":"#86c5f7","02":"#f5d271","03":"#ef8c6b","04":"#ec807c"}[t.alarm[0].level_code],i.query(h,".con.a .weather-alarm").onclick=function(){quik.alert(t.alarm[0].detail,(function(){setTimeout((function(){a=!1}),10)})),a=!0}}}}),{province:e.province,city:e.city,county:e.district,refresh:!0})}function p(e,t){var i=e.sunrise.split(":");i=60*parseInt(i[0])+parseInt(i[1]);var a,n=e.sunset.split(":");return n=60*parseInt(n[0])+parseInt(n[1]),i<(a=void 0===t?60*(a=new Date).getHours()+a.getMinutes():60*t)&&a<n?"day":"night"}s.show(),s.getIcon().onclick=function(e){e.stopPropagation(),u.show(300),u.setOffset({top:34,left:15},300)},document.addEventListener("click",(function(){a||(u.hide(300),u.setOffset({top:34,left:-315},300))})),r((function(e){console.log(e),d(e)}));var u=new quik.card({content:'<div class="tabi"><div class="item" data-i="a">今日</div><div class="item" data-i="b">七日天气</div><div class="item" data-i="c">24小时</div><div class="item" data-i="d">空气质量</div></div><div class="tabcon"><div class="con a" data-i="a"><div class="left"><div class="location"><span title="定位" class="relocate">icon{e0c8}</span><span class="replacecity" title="切换城市">---</span></div><div class="weatherss"><img src="https://mat1.gtimg.com/pingjs/ext2020/weather/pc/icon/weather/day/01.png"><p class="weather-temp">--℃</p><p class="weather-name">--</p></div></div><div class="right"><p class="weather-wind">icon{e569}<span>-风---级</span></p><p class="weather-wet">icon{e798}湿度 <span>--%</span></p><p class="weather-pa">icon{e87a}气压 <span>---hPa</span></p><p class="weather-alarm"></p></div></div><div class="con b" data-i="b"><div class="sc"><ul></ul></div></div><div class="con c" data-i="c"><div class="sc"><ul></ul></div></div><div class="con d" data-i="d"><div class="aqi"><p class="title">AQI</p><p class="result">-</p><p class="pinjia">-</p></div><div class="wurans"><div class="co"><p class="title">CO</p><p class="result">-</p></div><div class="no2"><p class="title">NO<sub>2</sub></p><p class="result">-</p></div><div class="o3"><p class="title">O<sub>3</sub></p><p class="result">-</p></div><div class="pm25"><p class="title">PM2.5</p><p class="result">-</p></div><div class="pm10"><p class="title">PM10</p><p class="result">-</p></div><div class="so2"><p class="title">SO<sub>2</sub></p><p class="result">-</p></div></div></div></div>'.replace(/icon{[a-zA-Z0-9]*}/g,(function(e){return i.getGoogleIcon(e.replace("icon{","").replace("}",""))})),class:"weather-card",width:300,height:200,offset:{top:34,left:-315}}),h=u.getCardDom();h.addEventListener("click",(function(e){e.stopPropagation()}));var w=i.query(h,".tabi .item",!0),v=i.query(h,".tabcon .con",!0);w.forEach((function(e){e.onclick=function(){w.forEach((function(e){e.classList.remove("active")})),v.forEach((function(e){e.classList.remove("active")})),this.classList.add("active"),i.query(h,'.tabcon .con[data-i="'+this.dataset.i+'"]').classList.add("active")}})),i.query(h,".relocate").addEventListener("click",(function(){l(),n.forEach((function(e){e.abort()})),r((function(e){d(e)}),{refresh:!0})}));var y,f,g,m=(y=new quik.dialog({content:'<div class="bar"><div class="closeBtn">{e5cd}</div><div class="searchcitybox"><input type="search" class="searchcityinput" placeholder="搜索市、区、县等"></div></div><div class="results"></div>'.replace("{e5cd}",i.getGoogleIcon("e5cd")),class:"cityselector",clickOtherToClose:!1}),f=function(){},g=y.getDialogDom(),i.query(g,".closeBtn").addEventListener("click",(function(){f(!1),y.close()})),i.query(g,".searchcityinput").addEventListener("input",(function(){if(""!=this.value.trim())var e=this.value.trim();i.jsonp("https://wis.qq.com/city/like?source=pc&city="+encodeURI(e),(function(t){if(t&&200==t.status){var n="";for(var c in t.data)n+='<div class="item" data-t="'+t.data[c]+'">'+t.data[c].replace(e,'<span style="color:#09f">'+e+"</span>")+"</div>";i.query(g,".results").innerHTML=n,i.query(g,".results .item",!0).forEach((function(e){e.onclick=function(){var e=this.dataset.t.split(", ");f({province:e[0],city:e[1],county:e[2]}),i.query(g,".results").innerHTML="",y.close(),setTimeout((function(){a=!1}),10)}}))}else i.query(g,".results").innerHTML="网络错误"}))})),function(e){a=!0,y.open(),f=e});i.query(h,".replacecity").addEventListener("click",(function(){m((function(i){i&&(e.set("location",{province:i.province,city:i.city,district:i.county}),t.location={province:i.province,city:i.city,district:i.county},l(),d({province:i.province,city:i.city,district:i.county}))}))})),w[0].click(),quik.util.addStyle(".weather-icon>div{display:flex;justify-content:center;align-items:center}.weather-icon>div>*{height:30px;line-height:30px;margin:0 2px;font-size:14px}.weather-icon img{height:24px;margin:3px 2px}.weather-card{user-select:none}.weather-card .tabi{width:100%;height:30px}.weather-card .tabi .item{float:left;margin:3px 5px;line-height:20px;height:20px;font-size:12px;padding:1px 5px;border-radius:3px;user-select:none}.weather-card .tabi .item.active{background-color:#eee}.weather-card .tabi .item:hover{background-color:#f6f6f6}.weather-card .tabcon{width:100%;height:calc(100% - 30px)}.weather-card .tabcon .con{width:100%;height:100%;display:none}.weather-card .tabcon .con.active{display:block}.weather-card .tabcon .con.a .left,.weather-card .tabcon .con.a .right{width:50%;height:100%;float:left;display:flex;justify-content:center;align-items:center;flex-direction:column}.weather-card .tabcon .con.a{text-align:center;line-height:20px}.weather-card .tabcon .con.a .right p{padding:5px 0}.weather-card .tabcon .con.a .right .weather-alarm{cursor:pointer;padding:0 1em;border-radius:1em;color:#fff;font-size:14px}.weather-card .tabcon .con.a .material-symbols-outlined{font-size:inherit;padding-right:5px;line-height:inherit;float:left}.weather-card .tabcon .sc{width:100%;height:100%;overflow-y:hidden;overflow-x:auto}.weather-card .tabcon .sc ul{height:100%}.weather-card .tabcon .sc ul li{width:80px;height:100%;margin:0 10px;float:left;list-style:none;font-size:12px;text-align:center}.weather-card .tabcon .sc ul li img{width:35px;display:block;height:35px;margin:0 auto}.weather-card .tabcon .con.c .sc ul li{font-size:16px}.weather-card .tabcon .con.c .sc ul li img{width:50px;height:50px}.weather-card .tabcon .con.c .sc ul li p.time{padding-top:10px}.weather-card .tabcon .con.c .sc ul li p.wind{font-size:12px}.weather-card .tabcon .con.d .aqi{width:80px;height:calc(100% - 40px);padding:20px 0;float:left;display:flex;flex-direction:column;justify-content:space-between;align-items:center}.weather-card .tabcon .con.d .aqi .result{font-size:20px}.weather-card .tabcon .con.d .wurans{float:left;width:calc(100% - 80px);height:100%}.weather-card .tabcon .con.d .wurans>*{float:left;width:calc(33% - 10px);height:calc(50% - 10px);display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#fafafa;border-radius:10px;margin:5px}.weather-card .tabcon .con.d .aqi p.pinjia{width:1em;height:1em;line-height:1em;border-radius:3px;font-size:12px;padding:4px}.cityselector .bar{overflow:hidden}.cityselector .bar>*{float:left;height:30px;font-size:16px;user-select:none}.cityselector .bar input{height:30px}.d-c.cityselector{height:300px}.cityselector .results{height:calc(100% - 30px);overflow:auto}body.dark .cards .weather-card{background-color:#333}body.dark .weather-card .tabi .item.active{background-color:#555}body.dark .weather-card .tabi .item:hover{background-color:#444}body.dark .weather-card .tabcon .con.d .wurans>*{background-color:#3a3a3a}")}():quik.alert("如您不同意，请卸载本插件。")}));