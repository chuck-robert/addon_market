/*QUIK_ADDON 1|便签|3|1.0.2|在右上角打开便签，快速记录一些事情，也可以将一条便签固定在页面左上方提醒自己|siquan|data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAd5JREFUaEPtWTtOwzAYtl1YkJK02TvDxgUYYIEVCakSO/QMXAJxABAXAIkLMFBRxMqIujAAAxKkL8FE/eOAiprGeblOYivuGNu/v5dTx8ZI8x/WHD8yBMp2kOvA17nbnFB6ggBvI4ytUkECjBHC1wDkyG6/9+axhAj8gUcPrKNbKvDw5F4N0PrKofcy2xQiMD6rXyJE9hQDP4VzYR14rXgCp41R6bGJUo/CyGr3nQQHXFBU/V9YzIFAajgR0pzAsOso7YCzMYx3wBDIeQEZB3IWOLG8cSBRopw7VNcB8ljLWdtgebo24c4n7ID2BAqVP2YyYQcMAUkKVNcB7Rex9gQkRXjhMtVdAwtLJ6lAdR0QXcRRexpRQ4Qd0J6AqGJpxuFv1uuNIPzJDhxo9Aiw6Y3dGmzFHmwVfSrhg8dPbKvO3z3/Y+WB9xtDB1uFE3hlyo/jrymiwCtBgPSY+hljo1SE4l4OYAPLfD+Q+fkVUnqEogikAa9GhDjf2mnBK0kgC3g+gVu70AuO2QhlBc8lMLhzrjCg3TR/QDL6TAmIgOcSGHWtVUDknjU2ZABMquETEAXPJeA//Oi4zeWlyTFQ2GH3ZXYSiEXa4Zl06vv9TdEa5qZeVDlZ44wDspQUrfMDQ3UCQPMbnfEAAAAASUVORK5CYII=|https://siquan001.github.io/|version.txt|siquan.notes */
if(quik.storage.checkIDB()){function e(e){var t=new Date(e),i=util.b0;return t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+i(t.getHours())+":"+i(t.getMinutes())}util.addStyle(".d-c.note-dialog{width:700px;height:400px;padding:0;background-color:transparent;overflow:hidden}body.dark .d-c.note-dialog{background-color:transparent}@media(max-width:700px){.d-c.note-dialog{width:600px}}.note-dialog .notelist{width:200px;height:100%;float:left;padding:10px;box-sizing:border-box;background-color:rgba(222,222,222,.5);backdrop-filter:blur(10px);overflow-y:auto}body.dark .note-dialog .notelist{background-color:rgba(33,33,33,.5)}.note-dialog .editor{width:calc(100% - 200px);height:100%;float:left;padding:10px;box-sizing:border-box;background-color:#fff}body.dark .note-dialog .editor{background-color:#333}.note-dialog .editor .controls{width:100%;height:30px}.note-dialog .editor .controls .item{float:left;width:26px;height:26px;border-radius:50%;margin:2px 6px;cursor:pointer;user-select:none;text-align:center}.note-dialog .editor .controls .item span{font-size:18px;line-height:26px}.note-dialog .editor .controls .item:hover{background-color:#eee}.note-dialog .editor .controls .item.pin.ed{color:#ff0}body.dark .note-dialog .editor .controls .item:hover{background-color:#666}.note-dialog .editor .controls .item.delete:hover{color:red}.note-dialog .editor textarea{width:100%;height:calc(100% - 30px);display:block;box-sizing:border-box;padding:10px;border:0;outline:0;font-size:14px;font-family:sans-serif;resize:none;background-color:transparent}.note-dialog .closebtn{position:absolute;top:10px;right:10px;width:26px;height:26px;border-radius:50%;margin:2px 6px;cursor:pointer;user-select:none;text-align:center}.note-dialog .closebtn span{font-size:18px;line-height:26px}.note-dialog .closebtn:hover{background-color:#eee}body.dark .note-dialog .closebtn:hover{background-color:#666}.note-dialog .notelist .item{width:100%;height:40px;margin:8px 0;cursor:pointer;border-radius:5px;transition:all .2s;padding:4px;box-sizing:border-box}.note-dialog .notelist .item.active{background-color:rgba(255,255,255,.3)!important}body.dark .note-dialog .notelist .item.active{background-color:rgba(0,0,0,.3)!important}.note-dialog .notelist .item:hover{background-color:rgba(255,255,255,.1)}body.dark .note-dialog .notelist .item:hover{background-color:rgba(0,0,0,.1)}.note-dialog .notelist .item.add{display:flex;justify-content:center;align-items:center}.note-dialog .notelist .item .title{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:20px;height:20px}.note-dialog .notelist .item .date{line-height:15px;font-size:12px;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}body.dark .note-dialog .notelist .item .date{color:#aaa}.note-dialog .notelist-btn{display:none}@media(max-width:600px){.dialog.mobile-show-full .d-c.note-dialog{width:100%;height:100%;overflow:hidden}.note-dialog .editor,.note-dialog .notelist{width:100%;height:100%;position:absolute;top:0;transition:left .3s}.note-dialog .notelist{left:-100%}.note-dialog .editor{left:100%}.note-dialog .editor.active,.note-dialog .notelist.active{left:0}.note-dialog .notelist-btn{display:block}}.fcard.note-fixed{background-color:rgba(255,255,255,.3);backdrop-filter:blur(10px);box-sizing:border-box;padding:10px;height:55px}body.dark .fcard.note-fixed,body.t-dark .fcard.note-fixed{background-color:rgba(0,0,0,.3)}.note-fixed .title{font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:20px;height:20px}.note-fixed .date{line-height:15px;font-size:14px;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.note-fixed .removePin{position:absolute;right:5px;top:15px;width:25px;height:25px;border-radius:50%;text-align:center;cursor:pointer}.note-fixed .removePin:hover{background-color:#eee}body.dark .note-fixed,body.t-dark .note-fixed{color:#fff}body.dark .note-fixed .removePin:hover,body.t-dark .note-fixed .removePin:hover{background-color:#666}.note-fixed .removePin span{font-size:16px;line-height:25px}body.dark .note-fixed .date,body.t-dark .note-fixed .date{color:#aaa}");var t=new quik.iconc.icon({content:util.getGoogleIcon("e745"),offset:"tr"});t.hide(),t.getIcon().onclick=d,quik.mainmenu.pushMenu({icon:util.getGoogleIcon("e745"),title:"便签",click:d});var i=function(){var e=quik.storage("notes",{sync:!0,title:"便签",desc:"便签数据",addon:"market:003",get:async function(){var t=e.getAll(),i={};for(var o in t)i[o]=await localforage.getItem(t[o]);return i},compare:async function(i,o,n){for(var r in n)if("comment"==r||"gdlist"==r){var d=await new Promise((function(t){e.get(r,!0,t)}));await new Promise((function(i){e.set(r,t(d,n[r]),!0,i)}))}else await new Promise((function(t){e.set(r,n[r],!0,t)}));i[o]=e.getAll()},rewrite:async function(t,i,o){for(var n=e.list(),r=0;r<n.length;r++)await new Promise((function(t){e.remove(n[r],!0,t)}));for(var r in o)await new Promise((function(t){e.set(r,o[r],!0,t)}));t[i]=e.getAll()}});function t(e,t){for(var i=[],o=0;o<t.length;o++){for(var n=!1,r=0;r<e.length;r++)if(e[r].id==t[o].id){n=!0,e[r]=t[o];break}n||i.push(o)}for(o=0;o<i.length;o++)e.push(t[i[o]]);return e}var i=quik.getEventHandle();function o(t){e.get("comment",!0,(function(e){t(e)}))}function n(e){var t="",i=e.indexOf("\n");return(t=-1!=i?e.substring(0,i):e).length>30?t.substring(0,30):t}function r(t){e.get("gdlist",!0,(function(e){t(e)}))}function d(t,n){o((function(o){for(var d=!1,a=0;a<o.length;a++)o[a].id==t&&(delete o[a].pined,d=!0);d?e.set("comment",o,!0,(function(){r((function(o){for(var r=!1,d=0;d<o.length;d++)if(o[d].id==t){o.splice(d,1),i.doevent("pinremove",{id:t}),e.set("gdlist",o,!0,n),r=!0;break}r||n({err:-1,msg:"未找到"})}))})):n({err:-1,msg:"未找到便签"})}))}return{getNotes:o,getPins:r,getNoteById:function(t,i){e.get("n-"+t,!0,(function(e){i(e)}))},pinNoteById:function(t,n){o((function(o){for(var d,a=!1,l=Date.now(),c=0;c<o.length;c++)o[c].id==t&&(o[c].pined=!0,a=!0,d=o[c].title);a?e.set("comment",o,!0,(function(){r((function(o){o.unshift({id:t,title:d,date:l}),e.set("gdlist",o,!0,(function(){i.doevent("pinadd",{id:t,title:d,date:l}),n({ok:1})}))}))})):n({err:-1,msg:"未找到便签"})}))},setNoteById:function(t,r,d){o((function(o){for(var a=!1,l=n(r),c=Date.now(),s=0;s<o.length;s++)if(o[s].id==t){o[s].title=l,o[s].date=c,a=!0;break}a?e.set("comment",o,!0,(function(){e.set("n-"+t,r,!0,(function(){i.doevent("change",{id:t,title:l,date:c}),d({ok:1})}))})):d({err:-1,msg:"未找到便签"})}))},removePinById:d,removeNoteById:function(t,n){o((function(o){for(var r=!1,a=!1,l=0;l<o.length;l++)if(o[l].id==t){o[l].pined&&(a=!0),o.splice(l,1),r=!0;break}function c(){e.set("comment",o,!0,(function(){console.log(t),e.remove("n-"+t,!0,(function(){i.doevent("remove",{id:t}),n({ok:1})}))}))}r?a?d(t,c):c():n({err:-1,msg:"未找到便签"})}))},createNote:function(t,r){o((function(o){var d=Math.random().toString(36).slice(2),a=n(t),l=Date.now();o.unshift({title:a,date:l,id:d}),e.set("comment",o,!0,(function(){e.set("n-"+d,t,!0,(function(){i.doevent("add",{id:d,title:a,date:l}),r({ok:1,id:d})}))}))}))},on:i.on,off:i.off,init:function(t){var i=0;function o(){2==++i&&t()}e.get("comment")?o():e.set("comment",[],!0,o),e.get("gdlist")?o():e.set("gdlist",[],!0,o)}}}(),o=function(){var t,o,n,r,d,a,l,c,s=!1,u="-add";function f(t,i,r){var d;function a(){var e=util.element("div",{class:"item","data-id":t.id});return e.onclick=function(){g(this.dataset.id)},e.innerHTML='<div class="title"></div><div class="date"></div>',r?l.parentElement.insertBefore(e,l.nextSibling):n.append(e),e}i?d=a():(d=util.query(o,'.notelist .item[data-id="'+t.id+'"]'))||(d=a()),d.querySelector(".title").innerText=t.title,d.querySelector(".date").innerText=e(t.date)}function g(e){u=e,util.query(o,".notelist").classList.remove("active"),util.query(o,".editor").classList.add("active"),util.query(o,".notelist-btn").classList.add("active");try{util.query(o,".notelist .item.active").classList.remove("active")}catch(e){}if(d.style.display="none","-add"!=e){try{util.query(o,'.notelist .item[data-id="'+e+'"]').classList.add("active")}catch(e){}i.getNoteById(e,(function(e){c.value=e,c.placeholder="Typing here...",a.style.display=""})),i.getNotes((function(t){t.find((t=>t.id==e)).pined?(d.querySelector("span").classList.add("fill"),d.classList.add("ed")):(d.querySelector("span").classList.remove("fill"),d.classList.remove("ed")),d.style.display=""}))}else{try{l.classList.add("active")}catch(e){}c.value="",c.placeholder="在此键入文本并保存以新建便签...",a.style.display="none"}}return{init:function(e){s?e():function(e){t=new quik.dialog({content:'<div class="notelist active"><div class="item add active"><div class="add">icon{e145}</div></div></div><div class="editor"><div class="controls"><div class="item notelist-btn">icon{e5c4}</div><div class="item save" title="保存（Ctrl+S）">icon{e161}</div><div class="item pin" title="固定到主界面">icon{e6aa}</div><div class="item delete" title="删除">icon{e872}</div></div><textarea placeholder="Typing here..."></textarea></div><div class="closebtn">icon{e5cd}</div>'.replace(/icon{[a-zA-Z0-9]*}/g,(function(e){return util.getGoogleIcon(e.replace("icon{","").replace("}",""))})),mobileShowtype:quik.dialog.SHOW_TYPE_FULLSCREEN,clickOtherToClose:!1,class:"note-dialog"}),o=t.getDialogDom(),n=util.query(o,".notelist"),util.query(o,".closebtn").addEventListener("click",(function(){t.close(),util.query(o,".notelist").classList.add("active"),util.query(o,".editor").classList.remove("active"),util.query(o,".notelist-btn").classList.remove("active")})),(l=util.query(o,".item.add")).addEventListener("click",(function(){g("-add")})),i.getNotes((function(t){for(var i=0;i<t.length;i++)f(t[i],!0);e()})),function(){function e(){"-add"==u?i.createNote(c.value,(function(e){quik.toast.show("已保存"),setTimeout((function(){g(e.id)}))})):i.setNoteById(u,c.value,(function(){quik.toast.show("已保存")}))}(c=util.query(o,"textarea")).onkeydown=function(t){t.ctrlKey&&"s"==t.key&&(t.preventDefault(),e())},r=util.query(o,".editor .save"),d=util.query(o,".editor .pin"),a=util.query(o,".editor .delete"),r.onclick=e,d.onclick=function(){this.classList.contains("ed")?i.removePinById(u,(function(){quik.toast.show("已取消固定"),d.querySelector("span").classList.remove("fill"),d.classList.remove("ed")})):i.pinNoteById(u,(function(){quik.toast.show("已固定到主界面"),d.querySelector("span").classList.add("fill"),d.classList.add("ed")}))},a.onclick=function(){quik.confirm("你确定要删除吗？该操作不可恢复！",(function(e){e&&i.removeNoteById(u,(function(){quik.toast.show("已删除")}))}))}}(),g("-add"),i.on("add",(function(e){f(e,!0,!0)})),i.on("change",(function(e){f(e)})),i.on("remove",(function(e){try{util.query(o,'.notelist .item[data-id="'+e.id+'"]').remove()}catch(e){}g("-add")})),util.query(o,".notelist-btn").onclick=function(){util.query(o,".notelist").classList.add("active"),util.query(o,".editor").classList.remove("active"),util.query(o,".notelist-btn").classList.remove("active")},s=!0}(e)},open:function(e){setTimeout((function(){t.open(),e&&g(e)}),10)}}}(),n=function(){var t=[];function n(n){var r=new quik.fcard({content:'<div class="title"></div><div class="date"></div><div class="removePin">'+util.getGoogleIcon("e5cd")+"</div>",class:"note-fixed"}),d=r.getFCardDom();d.dataset.id=n.id,util.query(d,".title").innerText=n.title,util.query(d,".date").innerText=e(n.date);var a=!1;d.onclick=function(){if(a)a=!1;else{var e=this;o.init((function(){o.open(e.dataset.id)}))}},util.query(d,".removePin").onclick=function(){a=!0,console.log("r"),i.removePinById(this.parentElement.parentElement.dataset.id,(function(e){e.err?quik.toast.show(e.msg):quik.toast.show("已取消固定")}))},t.push({id:n.id,fc:r})}function r(i){for(var o=0;o<t.length;o++)if(t[o].id==i.id){var n=t[o].fc.getFCardDom();util.query(n,".title").innerText=i.title,util.query(n,".date").innerText=e(i.date);break}}function d(e){for(var i=0;i<t.length;i++)if(t[i].id==e.id){t[i].fc.destroy(),t.splice(i,1);break}}return{init:function(){i.getPins((function(e){e.forEach(n)})),i.on("pinadd",n),i.on("change",r),i.on("pinremove",d),i.on("remove",d)}}}(),r=!1;function d(){r&&o.init((function(){o.open()}))}i.init((function(){n.init(),r=!0,t.show()}))}else quik.alert("便签需要使用浏览器的indexedDB API作服务，不支持在访客模式下使用。或您的浏览器版本过低，请升级您的浏览器");