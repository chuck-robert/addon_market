/*QUIK_ADDON 1|便签|1|1.0.0|在右上角打开便签，快速记录一些事情，也可以将一条便签固定在页面左上方提醒自己|siquan|data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAd5JREFUaEPtWTtOwzAYtl1YkJK02TvDxgUYYIEVCakSO/QMXAJxABAXAIkLMFBRxMqIujAAAxKkL8FE/eOAiprGeblOYivuGNu/v5dTx8ZI8x/WHD8yBMp2kOvA17nbnFB6ggBvI4ytUkECjBHC1wDkyG6/9+axhAj8gUcPrKNbKvDw5F4N0PrKofcy2xQiMD6rXyJE9hQDP4VzYR14rXgCp41R6bGJUo/CyGr3nQQHXFBU/V9YzIFAajgR0pzAsOso7YCzMYx3wBDIeQEZB3IWOLG8cSBRopw7VNcB8ljLWdtgebo24c4n7ID2BAqVP2YyYQcMAUkKVNcB7Rex9gQkRXjhMtVdAwtLJ6lAdR0QXcRRexpRQ4Qd0J6AqGJpxuFv1uuNIPzJDhxo9Aiw6Y3dGmzFHmwVfSrhg8dPbKvO3z3/Y+WB9xtDB1uFE3hlyo/jrymiwCtBgPSY+hljo1SE4l4OYAPLfD+Q+fkVUnqEogikAa9GhDjf2mnBK0kgC3g+gVu70AuO2QhlBc8lMLhzrjCg3TR/QDL6TAmIgOcSGHWtVUDknjU2ZABMquETEAXPJeA//Oi4zeWlyTFQ2GH3ZXYSiEXa4Zl06vv9TdEa5qZeVDlZ44wDspQUrfMDQ3UCQPMbnfEAAAAASUVORK5CYII=|https://siquan001.github.io/|version.txt|siquan.notes */
if(quik.storage.checkIDB()){function e(e){var t=new Date(e),i=util.b0;return t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+i(t.getHours())+":"+i(t.getMinutes())}util.addStyle(".d-c.note-dialog{width:700px;height:400px;padding:0;background-color:transparent;overflow:hidden}body.dark .d-c.note-dialog{background-color:transparent}@media(max-width:700px){.d-c.note-dialog{width:600px}}.note-dialog .notelist{width:200px;height:100%;float:left;padding:10px;box-sizing:border-box;background-color:rgba(222,222,222,.5);backdrop-filter:blur(10px);overflow-y:auto}body.dark .note-dialog .notelist{background-color:rgba(33,33,33,.5)}.note-dialog .editor{width:calc(100% - 200px);height:100%;float:left;padding:10px;box-sizing:border-box;background-color:#fff}body.dark .note-dialog .editor{background-color:#333}.note-dialog .editor .controls{width:100%;height:30px}.note-dialog .editor .controls .item{float:left;width:26px;height:26px;border-radius:50%;margin:2px 6px;cursor:pointer;user-select:none;text-align:center}.note-dialog .editor .controls .item span{font-size:18px;line-height:26px}.note-dialog .editor .controls .item:hover{background-color:#eee}.note-dialog .editor .controls .item.pin.ed{color:#ff0}body.dark .note-dialog .editor .controls .item:hover{background-color:#666}.note-dialog .editor .controls .item.delete:hover{color:red}.note-dialog .editor textarea{width:100%;height:calc(100% - 30px);display:block;box-sizing:border-box;padding:10px;border:0;outline:0;font-size:14px;font-family:sans-serif;resize:none;background-color:transparent}.note-dialog .closebtn{position:absolute;top:10px;right:10px;width:26px;height:26px;border-radius:50%;margin:2px 6px;cursor:pointer;user-select:none;text-align:center}.note-dialog .closebtn span{font-size:18px;line-height:26px}.note-dialog .closebtn:hover{background-color:#eee}body.dark .note-dialog .closebtn:hover{background-color:#666}.note-dialog .notelist .item{width:100%;height:40px;margin:8px 0;cursor:pointer;border-radius:5px;transition:all .2s;padding:4px;box-sizing:border-box}.note-dialog .notelist .item.active{background-color:rgba(255,255,255,.3)!important}body.dark .note-dialog .notelist .item.active{background-color:rgba(0,0,0,.3)!important}.note-dialog .notelist .item:hover{background-color:rgba(255,255,255,.1)}body.dark .note-dialog .notelist .item:hover{background-color:rgba(0,0,0,.1)}.note-dialog .notelist .item.add{display:flex;justify-content:center;align-items:center}.note-dialog .notelist .item .title{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:20px;height:20px}.note-dialog .notelist .item .date{line-height:15px;font-size:12px;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}body.dark .note-dialog .notelist .item .date{color:#aaa}.note-dialog .notelist-btn{display:none}@media(max-width:600px){.dialog.mobile-show-full .d-c.note-dialog{width:100%;height:100%;overflow:hidden}.note-dialog .editor,.note-dialog .notelist{width:100%;height:100%;position:absolute;top:0;transition:left .3s}.note-dialog .notelist{left:-100%}.note-dialog .editor{left:100%}.note-dialog .editor.active,.note-dialog .notelist.active{left:0}.note-dialog .notelist-btn{display:block}}.fcard.note-fixed{background-color:rgba(255,255,255,.3);backdrop-filter:blur(10px);box-sizing:border-box;padding:10px;height:55px}body.dark .fcard.note-fixed{background-color:rgba(0,0,0,.3)}.note-fixed .title{font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:20px;height:20px}.note-fixed .date{line-height:15px;font-size:14px;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.note-fixed .removePin{position:absolute;right:5px;top:15px;width:25px;height:25px;border-radius:50%;text-align:center;cursor:pointer}.note-fixed .removePin:hover{background-color:#eee}body.dark .note-fixed .removePin:hover{background-color:#666}.note-fixed .removePin span{font-size:16px;line-height:25px}body.dark .note-fixed .date{color:#aaa}");var t=new quik.iconc.icon({content:util.getGoogleIcon("e745"),offset:"tr"});t.hide(),t.getIcon().onclick=a,quik.mainmenu.pushMenu({icon:util.getGoogleIcon("e745"),title:"便签",click:a});var i=function(){var e=quik.storage("notes"),t=quik.getEventHandle();function i(t){e.get("comment",!0,(function(e){t(e)}))}function o(e){var t="",i=e.indexOf("\n");return(t=-1!=i?e.substring(0,i):e).length>30?t.substring(0,30):t}function n(t){e.get("gdlist",!0,(function(e){t(e)}))}function d(i,o){n((function(n){for(var d=!1,a=0;a<n.length;a++)if(n[a].id==i){n.splice(a,1),t.doevent("pinremove",{id:i}),e.set("gdlist",n,!0,o),d=!0;break}d||o({err:-1,msg:"未找到"})}))}return{getNotes:i,getPins:n,getNoteById:function(t,i){e.get("n-"+t,!0,(function(e){i(e)}))},pinNoteById:function(o,d){i((function(i){for(var a,l=!1,r=Date.now(),c=0;c<i.length;c++)i[c].id==o&&(i[c].pined=!0,l=!0,a=i[c].title);l?e.set("comment",i,!0,(function(){n((function(i){i.unshift({id:o,title:a,date:r}),e.set("gdlist",i,!0,(function(){t.doevent("pinadd",{id:o,title:a,date:r}),d({ok:1})}))}))})):d({err:-1,msg:"未找到便签"})}))},setNoteById:function(n,d,a){i((function(i){for(var l=!1,r=o(d),c=Date.now(),s=0;s<i.length;s++)if(i[s].id==n){i[s].title=r,i[s].date=c,l=!0;break}l?e.set("comment",i,!0,(function(){e.set("n-"+n,d,!0,(function(){t.doevent("change",{id:n,title:r,date:c}),a({ok:1})}))})):a({err:-1,msg:"未找到便签"})}))},removePinById:d,removeNoteById:function(o,n){i((function(i){for(var a=!1,l=!1,r=0;r<i.length;r++)if(i[r].id==o){i[r].pined&&(l=!0),i.splice(r,1),a=!0;break}function c(){e.set("comment",i,!0,(function(){console.log(o),e.remove("n-"+o,!0,(function(){t.doevent("remove",{id:o}),n({ok:1})}))}))}a?l?d(o,c):c():n({err:-1,msg:"未找到便签"})}))},createNote:function(n,d){i((function(i){var a=Math.random().toString(36).slice(2),l=o(n),r=Date.now();i.unshift({title:l,date:r,id:a}),e.set("comment",i,!0,(function(){e.set("n-"+a,n,!0,(function(){t.doevent("add",{id:a,title:l,date:r}),d({ok:1,id:a})}))}))}))},on:t.on,off:t.off,init:function(t){var i=0;function o(){2==++i&&t()}e.get("comment")?o():e.set("comment",[],!0,o),e.get("gdlist")?o():e.set("gdlist",[],!0,o)}}}(),o=function(){var t,o,n,d,a,l,r,c,s=!1,u="-add";function g(t,i,d){var a;function l(){var e=util.element("div",{class:"item","data-id":t.id});return e.onclick=function(){f(this.dataset.id)},e.innerHTML='<div class="title"></div><div class="date"></div>',d?r.parentElement.insertBefore(e,r.nextSibling):n.append(e),e}i?a=l():(a=util.query(o,'.notelist .item[data-id="'+t.id+'"]'))||(a=l()),a.querySelector(".title").innerText=t.title,a.querySelector(".date").innerText=e(t.date)}function f(e){u=e,util.query(o,".notelist").classList.remove("active"),util.query(o,".editor").classList.add("active"),util.query(o,".notelist-btn").classList.add("active");try{util.query(o,".notelist .item.active").classList.remove("active")}catch(e){}if(a.style.display="none","-add"!=e){try{util.query(o,'.notelist .item[data-id="'+e+'"]').classList.add("active")}catch(e){}i.getNoteById(e,(function(e){c.value=e,c.placeholder="Typing here...",l.style.display=""})),i.getNotes((function(t){t.find((t=>t.id==e)).pined?(a.querySelector("span").classList.add("fill"),a.classList.add("ed")):(a.querySelector("span").classList.remove("fill"),a.classList.remove("ed")),a.style.display=""}))}else{try{r.classList.add("active")}catch(e){}c.value="",c.placeholder="在此键入文本并保存以新建便签...",l.style.display="none"}}return{init:function(e){s?e():function(e){t=new quik.dialog({content:'<div class="notelist active"><div class="item add active"><div class="add">icon{e145}</div></div></div><div class="editor"><div class="controls"><div class="item notelist-btn">icon{e5c4}</div><div class="item save" title="保存（Ctrl+S）">icon{e161}</div><div class="item pin" title="固定到主界面">icon{e6aa}</div><div class="item delete" title="删除">icon{e872}</div></div><textarea placeholder="Typing here..."></textarea></div><div class="closebtn">icon{e5cd}</div>'.replace(/icon{[a-zA-Z0-9]*}/g,(function(e){return util.getGoogleIcon(e.replace("icon{","").replace("}",""))})),mobileShowtype:quik.dialog.SHOW_TYPE_FULLSCREEN,clickOtherToClose:!1,class:"note-dialog"}),o=t.getDialogDom(),n=util.query(o,".notelist"),util.query(o,".closebtn").addEventListener("click",(function(){t.close(),util.query(o,".notelist").classList.add("active"),util.query(o,".editor").classList.remove("active"),util.query(o,".notelist-btn").classList.remove("active")})),(r=util.query(o,".item.add")).addEventListener("click",(function(){f("-add")})),i.getNotes((function(t){for(var i=0;i<t.length;i++)g(t[i],!0);e()})),function(){function e(){"-add"==u?i.createNote(c.value,(function(e){quik.toast.show("已保存"),setTimeout((function(){f(e.id)}))})):i.setNoteById(u,c.value,(function(){quik.toast.show("已保存")}))}(c=util.query(o,"textarea")).onkeydown=function(t){t.ctrlKey&&"s"==t.key&&(t.preventDefault(),e())},d=util.query(o,".editor .save"),a=util.query(o,".editor .pin"),l=util.query(o,".editor .delete"),d.onclick=e,a.onclick=function(){this.classList.contains("ed")?i.removePinById(u,(function(){quik.toast.show("已取消固定"),a.querySelector("span").classList.remove("fill"),a.classList.remove("ed")})):i.pinNoteById(u,(function(){quik.toast.show("已固定到主界面"),a.querySelector("span").classList.add("fill"),a.classList.add("ed")}))},l.onclick=function(){quik.confirm("你确定要删除吗？该操作不可恢复！",(function(e){e&&i.removeNoteById(u,(function(){quik.toast.show("已删除")}))}))}}(),f("-add"),i.on("add",(function(e){g(e,!0,!0)})),i.on("change",(function(e){g(e)})),i.on("remove",(function(e){try{util.query(o,'.notelist .item[data-id="'+e.id+'"]').remove()}catch(e){}f("-add")})),util.query(o,".notelist-btn").onclick=function(){util.query(o,".notelist").classList.add("active"),util.query(o,".editor").classList.remove("active"),util.query(o,".notelist-btn").classList.remove("active")},s=!0}(e)},open:function(e){setTimeout((function(){t.open(),e&&f(e)}),10)}}}(),n=function(){var t=[];function n(n){var d=new quik.fcard({content:'<div class="title"></div><div class="date"></div><div class="removePin">'+util.getGoogleIcon("e5cd")+"</div>",class:"note-fixed"}),a=d.getFCardDom();a.dataset.id=n.id,util.query(a,".title").innerText=n.title,util.query(a,".date").innerText=e(n.date);var l=!1;a.onclick=function(){if(l)l=!1;else{var e=this;o.init((function(){o.open(e.dataset.id)}))}},util.query(a,".removePin").onclick=function(){l=!0,console.log("r"),i.removePinById(this.parentElement.parentElement.dataset.id,(function(e){e.err?quik.toast.show(e.msg):quik.toast.show("已取消固定")}))},t.push({id:n.id,fc:d})}function d(i){for(var o=0;o<t.length;o++)if(t[o].id==i.id){var n=t[o].fc.getFCardDom();util.query(n,".title").innerText=i.title,util.query(n,".date").innerText=e(i.date);break}}function a(e){for(var i=0;i<t.length;i++)if(t[i].id==e.id){t[i].fc.destroy(),t.splice(i,1);break}}return{init:function(){i.getPins((function(e){e.forEach(n)})),i.on("pinadd",n),i.on("change",d),i.on("pinremove",a),i.on("remove",a)}}}(),d=!1;function a(){d&&o.init((function(){o.open()}))}i.init((function(){n.init(),d=!0,t.show()}))}else quik.alert("便签需要使用浏览器的indexedDB API作服务，不支持在访客模式下使用。或您的浏览器版本过低，请升级您的浏览器");